# This script updates c_partstates to mediumtext
# adds c_description to Calendar quick tables
# http://www.sogo.nu/bugs/view.php?id=3175
# the field length was actually changed in v2.2.18

MYSQLSOGOPASS=$(/sbin/e-smith/config getprop sogod DbPassword)

tables=$(/usr/bin/mysql -B -N -usogo -p${MYSQLSOGOPASS} sogo -e "SELECT SUBSTRING_INDEX(c_quick_location, '/', -1) FROM sogo_folder_info WHERE c_path3 = 'Calendar'")

for table in $tables;
do
    /usr/bin/mysql -usogo -p${MYSQLSOGOPASS} sogo -e "ALTER TABLE $table MODIFY c_partstates mediumtext" 2>/dev/null
    /usr/bin/mysql -usogo -p${MYSQLSOGOPASS} sogo -e "ALTER TABLE $table ADD COLUMN c_description mediumtext" 2>/dev/null
done
